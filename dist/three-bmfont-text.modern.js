import{BufferGeometry as t,BufferAttribute as n,Sphere as r,Box3 as e}from"three";function i(){return(i=Object.assign||function(t){for(var n=1;n<arguments.length;n++){var r=arguments[n];for(var e in r)Object.prototype.hasOwnProperty.call(r,e)&&(t[e]=r[e])}return t}).apply(this,arguments)}var o,a=(function(t){var n=/\n/,r="\n",e=/\s/;function i(t,n,r,e){var i=t.indexOf(n,r);return-1===i||i>e?e:i}function o(t){return e.test(t)}function a(t,n,r,e){return{start:n,end:n+Math.min(e,r-n)}}t.exports=function(n,r){return t.exports.lines(n,r).map(function(t){return n.substring(t.start,t.end)}).join("\n")},t.exports.lines=function(t,e){if(0===(e=e||{}).width&&"nowrap"!==e.mode)return[];t=t||"";var s="number"==typeof e.width?e.width:Number.MAX_VALUE,h=Math.max(0,e.start||0),u="number"==typeof e.end?e.end:t.length,c=e.mode,f=e.measure||a;return"pre"===c?function(t,r,e,i,o){for(var a=[],s=e,h=e;h<i&&h<r.length;h++){var u=r.charAt(h),c=n.test(u);if(c||h===i-1){var f=t(r,s,c?h:h+1,o);a.push(f),s=h+1}}return a}(f,t,h,u,s):function(t,n,e,a,s,h){var u=[],c=s;for("nowrap"===h&&(c=Number.MAX_VALUE);e<a&&e<n.length;){for(var f=i(n,r,e,a);e<f&&o(n.charAt(e));)e++;var l=t(n,e,f,c),p=e+(l.end-l.start),d=p+r.length;if(p<f){for(;p>e&&!o(n.charAt(p));)p--;if(p===e)d>e+r.length&&d--,p=d;else for(d=p;p>e&&o(n.charAt(p-r.length));)p--}if(p>=e){var g=t(n,e,p,c);u.push(g)}e=d}return u}(f,t,h,u,s,c)}}(o={exports:{}}),o.exports),s=function(){for(var t={},n=0;n<arguments.length;n++){var r=arguments[n];for(var e in r)h.call(r,e)&&(t[e]=r[e])}return t},h=Object.prototype.hasOwnProperty,u=function(t,n){return"number"==typeof t?t:"number"==typeof n?n:0},c=["x","e","a","o","n","s","r","c","u","m","v","w","z"],f=["m","w"],l=["H","I","N","E","F","K","L","T","U","V","W","X","Y","Z"],p="\t".charCodeAt(0),d=" ".charCodeAt(0),g=function(t){return new y(t)};function y(t){this.glyphs=[],this._measure=this.computeMetrics.bind(this),this.update(t)}function m(t){return new Function(["return function "+t+"() {","  return this._"+t,"}"].join("\n"))()}function v(t,n){if(!t.chars||0===t.chars.length)return null;var r=x(t.chars,n);return r>=0?t.chars[r]:null}function b(t,n,r){if(!t.kernings||0===t.kernings.length)return 0;for(var e=t.kernings,i=0;i<e.length;i++){var o=e[i];if(o.first===n&&o.second===r)return o.amount}return 0}function x(t,n,r){for(var e=r=r||0;e<t.length;e++)if(t[e].id===n)return e;return-1}y.prototype.update=function(t){if(t=s({measure:this._measure},t),this._opt=t,this._opt.tabSize=u(this._opt.tabSize,4),!t.font)throw new Error("must provide a valid bitmap font");var n=this.glyphs,r=t.text||"",e=t.font;this._setupSpaceGlyphs(e);var i=a.lines(r,t),o=t.width||0;n.length=0;var h=i.reduce(function(t,n){return Math.max(t,n.width,o)},0),f=0,p=0,d=u(t.lineHeight,e.common.lineHeight),g=e.common.base,y=d-g,m=t.letterSpacing||0,v=d*i.length-y,w=function(t){return"center"===t?1:"right"===t?2:0}(this._opt.align);p-=v,this._width=h,this._height=v,this._descender=d-g,this._baseline=g,this._xHeight=function(t){for(var n=0;n<c.length;n++){var r=c[n].charCodeAt(0),e=x(t.chars,r);if(e>=0)return t.chars[e].height}return 0}(e),this._capHeight=function(t){for(var n=0;n<l.length;n++){var r=l[n].charCodeAt(0),e=x(t.chars,r);if(e>=0)return t.chars[e].height}return 0}(e),this._lineHeight=d,this._ascender=d-y-this._xHeight;var _=this;i.forEach(function(t,i){for(var o,a=t.end,s=t.width,u=t.start;u<a;u++){var c=r.charCodeAt(u),l=_.getGlyph(e,c);if(l){o&&(f+=b(e,o.id,l.id));var g=f;1===w?g+=(h-s)/2:2===w&&(g+=h-s),n.push({position:[g,p],data:l,index:u,line:i}),f+=l.xadvance+m,o=l}}p+=d,f=0}),this._linesTotal=i.length},y.prototype._setupSpaceGlyphs=function(t){if(this._fallbackSpaceGlyph=null,this._fallbackTabGlyph=null,t.chars&&0!==t.chars.length){var n=v(t,d)||function(t){for(var n=0;n<f.length;n++){var r=f[n].charCodeAt(0),e=x(t.chars,r);if(e>=0)return t.chars[e]}return 0}(t)||t.chars[0],r=this._opt.tabSize*n.xadvance;this._fallbackSpaceGlyph=n,this._fallbackTabGlyph=s(n,{x:0,y:0,xadvance:r,id:p,xoffset:0,yoffset:0,width:0,height:0})}},y.prototype.getGlyph=function(t,n){return v(t,n)||(n===p?this._fallbackTabGlyph:n===d?this._fallbackSpaceGlyph:null)},y.prototype.computeMetrics=function(t,n,r,e){var i,o=this._opt.letterSpacing||0,a=this._opt.font,s=0,h=0,u=0;if(!a.chars||0===a.chars.length)return{start:n,end:n,width:0};r=Math.min(t.length,r);for(var c=n;c<r;c++){var f,l=t.charCodeAt(c);if(f=this.getGlyph(a,l)){var p=(s+=i?b(a,i.id,f.id):0)+f.xadvance+o,d=s+f.width;if(d>=e||p>=e)break;s=p,h=d,i=f}u++}return i&&(h+=i.xoffset),{start:n,end:n+u,width:h}},["width","height","descender","ascender","xHeight","baseline","capHeight","lineHeight"].forEach(function(t){Object.defineProperty(y.prototype,t,{get:m(t),configurable:!0})});var w=Object.prototype.toString;function _(t){return!!t.constructor&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)}var A=[0,2,3],S=[2,1,3];function E(t){const n=t.length/2,r={min:[t[0],t[1]],max:[t[0],t[1]]};for(let e=0;e<n;e++){const n=t[2*e+0],i=t[2*e+1];r.min[0]=Math.min(n,r.min[0]),r.min[1]=Math.min(i,r.min[1]),r.max[0]=Math.max(n,r.max[0]),r.max[1]=Math.max(i,r.max[1])}return r}class M extends t{constructor(t){super(),this.options=void 0,this.layout=void 0,this.visibleGlyphs=void 0,this.options=i({},t),this.update(t)}update(t){if(!(t=i({},this.options,t)).font)throw new TypeError("must specify a { font } in options");this.layout=g(t);const r=!1!==t.flipY,{font:e}=t,o=e.common.scaleW,a=e.common.scaleH,s=this.layout.glyphs.filter(({data:t})=>t.width*t.height>0);this.visibleGlyphs=s;const h=function(t){const n=new Float32Array(4*t.length*2);let r=0;return t.forEach(t=>{const e=t.data,i=t.position[0]+e.xoffset,o=t.position[1]+e.yoffset,a=e.width,s=e.height;n[r++]=i,n[r++]=o,n[r++]=i,n[r++]=o+s,n[r++]=i+a,n[r++]=o+s,n[r++]=i+a,n[r++]=o}),n}(s),u=function(t,n,r,e){const i=new Float32Array(4*t.length*2);let o=0;return t.forEach(t=>{const a=t.data,s=a.y+a.height,h=a.x/n;let u=a.y/r;const c=(a.x+a.width)/n;let f=s/r;e&&(u=(r-a.y)/r,f=(r-s)/r),i[o++]=h,i[o++]=u,i[o++]=h,i[o++]=f,i[o++]=c,i[o++]=f,i[o++]=c,i[o++]=u}),i}(s,o,a,r),c=function(t,n){var r,e;t&&((e=t).BYTES_PER_ELEMENT&&"[object ArrayBuffer]"===w.call(e.buffer)||Array.isArray(e)||null!=(r=t)&&(_(r)||function(t){return"function"==typeof t.readFloatLE&&"function"==typeof t.slice&&_(t.slice(0,0))}(r)||r._isBuffer))||(n=t||{},t=null);for(var i=(n="number"==typeof n?{count:n}:n||{}).start||0,o=!1!==n.clockwise?A:S,a=o[0],s=o[1],h=o[2],u=6*("number"==typeof n.count?n.count:1),c=t||new(function(t){switch(t){case"int8":return Int8Array;case"int16":return Int16Array;case"int32":return Int32Array;case"uint8":return Uint8Array;case"uint16":return Uint16Array;case"uint32":return Uint32Array;case"float32":return Float32Array;case"float64":return Float64Array;case"array":return Array;case"uint8_clamped":return Uint8ClampedArray}}("string"==typeof n.type?n.type:"uint16"))(u),f=0,l=0;f<u;f+=6,l+=4){var p=f+i;c[p+0]=l+0,c[p+1]=l+1,c[p+2]=l+2,c[p+3]=l+a,c[p+4]=l+s,c[p+5]=l+h}return c}({clockwise:!0,type:"uint16",count:s.length});this.setIndex(new n(c,1)),this.setAttribute("position",new n(h,2)),this.setAttribute("uv",new n(u,2)),"page"in this.attributes&&this.deleteAttribute("page")}computeBoundingSphere(){this.boundingSphere||(this.boundingSphere=new r);const t=this.attributes.position.array,{itemSize:n}=this.attributes.position;if(!t||!n||t.length<2)return this.boundingSphere.radius=0,void this.boundingSphere.center.set(0,0,0);!function(t,n){const r=E(t),e=r.min[0],i=r.min[1],o=r.max[0]-e,a=r.max[1]-i,s=Math.sqrt(o*o+a*a);n.center.set(e+o/2,i+a/2,0),n.radius=s/2}(t,this.boundingSphere)}computeBoundingBox(){this.boundingBox||(this.boundingBox=new e);const t=this.attributes.position.array,{itemSize:n}=this.attributes.position;!t||!n||t.length<2?this.boundingBox.makeEmpty():function(t,n){const r=E(t);n.min.set(r.min[0],r.min[1],0),n.max.set(r.max[0],r.max[1],0)}(t,this.boundingBox)}}export{M as TextGeometry,g as __moduleExports};
//# sourceMappingURL=three-bmfont-text.modern.js.map
