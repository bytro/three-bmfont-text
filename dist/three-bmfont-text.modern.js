import{BufferGeometry as t,BufferAttribute as n,Sphere as e,Box3 as r}from"three";var i,a=(function(t){var n=/\n/,e=/\s/;function r(t,n,e,r){var i=t.indexOf(n,e);return-1===i||i>r?r:i}function i(t){return e.test(t)}function a(t,n,e,r){return{start:n,end:n+Math.min(r,e-n)}}t.exports=function(n,e){return t.exports.lines(n,e).map(function(t){return n.substring(t.start,t.end)}).join("\n")},t.exports.lines=function(t,e){if(0===(e=e||{}).width&&"nowrap"!==e.mode)return[];t=t||"";var o="number"==typeof e.width?e.width:Number.MAX_VALUE,s=Math.max(0,e.start||0),h="number"==typeof e.end?e.end:t.length,u=e.mode,c=e.measure||a;return"pre"===u?function(t,e,r,i,a){for(var o=[],s=r,h=r;h<i&&h<e.length;h++){var u=e.charAt(h),c=n.test(u);if(c||h===i-1){var f=t(e,s,c?h:h+1,a);o.push(f),s=h+1}}return o}(c,t,s,h,o):function(t,n,e,a,o,s){var h=[],u=o;for("nowrap"===s&&(u=Number.MAX_VALUE);e<a&&e<n.length;){for(var c=r(n,"\n",e,a);e<c&&i(n.charAt(e));)e++;var f=t(n,e,c,u),l=e+(f.end-f.start),p=l+"\n".length;if(l<c){for(;l>e&&!i(n.charAt(l));)l--;if(l===e)p>e+"\n".length&&p--,l=p;else for(p=l;l>e&&i(n.charAt(l-"\n".length));)l--}if(l>=e){var d=t(n,e,l,u);h.push(d)}e=p}return h}(c,t,s,h,o,u)}}(i={exports:{}}),i.exports),o=function(){for(var t={},n=0;n<arguments.length;n++){var e=arguments[n];for(var r in e)s.call(e,r)&&(t[r]=e[r])}return t},s=Object.prototype.hasOwnProperty,h=function(t,n){return"number"==typeof t?t:"number"==typeof n?n:0},u=["x","e","a","o","n","s","r","c","u","m","v","w","z"],c=["m","w"],f=["H","I","N","E","F","K","L","T","U","V","W","X","Y","Z"],l="\t".charCodeAt(0),p=" ".charCodeAt(0);function d(t){this.glyphs=[],this._measure=this.computeMetrics.bind(this),this.update(t)}function g(t){return new Function(["return function "+t+"() {","  return this._"+t,"}"].join("\n"))()}function m(t,n){if(!t.chars||0===t.chars.length)return null;var e=b(t.chars,n);return e>=0?t.chars[e]:null}function y(t,n,e){if(!t.kernings||0===t.kernings.length)return 0;for(var r=t.kernings,i=0;i<r.length;i++){var a=r[i];if(a.first===n&&a.second===e)return a.amount}return 0}function b(t,n,e){for(var r=e=e||0;r<t.length;r++)if(t[r].id===n)return r;return-1}d.prototype.update=function(t){if(t=o({measure:this._measure},t),this._opt=t,this._opt.tabSize=h(this._opt.tabSize,4),!t.font)throw new Error("must provide a valid bitmap font");var n=this.glyphs,e=t.text||"",r=t.font;this._setupSpaceGlyphs(r);var i=a.lines(e,t),s=t.width||0;n.length=0;var c=i.reduce(function(t,n){return Math.max(t,n.width,s)},0),l=0,p=0,d=h(t.lineHeight,r.common.lineHeight),g=r.common.base,m=d-g,v=t.letterSpacing||0,x=d*i.length-m,w=function(t){return"center"===t?1:"right"===t?2:0}(this._opt.align);p-=x,this._width=c,this._height=x,this._descender=d-g,this._baseline=g,this._xHeight=function(t){for(var n=0;n<u.length;n++){var e=u[n].charCodeAt(0),r=b(t.chars,e);if(r>=0)return t.chars[r].height}return 0}(r),this._capHeight=function(t){for(var n=0;n<f.length;n++){var e=f[n].charCodeAt(0),r=b(t.chars,e);if(r>=0)return t.chars[r].height}return 0}(r),this._lineHeight=d,this._ascender=d-m-this._xHeight;var _=this;i.forEach(function(t,i){for(var a,o=t.end,s=t.width,h=t.start;h<o;h++){var u=e.charCodeAt(h),f=_.getGlyph(r,u);if(f){a&&(l+=y(r,a.id,f.id));var g=l;1===w?g+=(c-s)/2:2===w&&(g+=c-s),n.push({position:[g,p],data:f,index:h,line:i}),l+=f.xadvance+v,a=f}}p+=d,l=0}),this._linesTotal=i.length},d.prototype._setupSpaceGlyphs=function(t){if(this._fallbackSpaceGlyph=null,this._fallbackTabGlyph=null,t.chars&&0!==t.chars.length){var n=m(t,p)||function(t){for(var n=0;n<c.length;n++){var e=c[n].charCodeAt(0),r=b(t.chars,e);if(r>=0)return t.chars[r]}return 0}(t)||t.chars[0],e=this._opt.tabSize*n.xadvance;this._fallbackSpaceGlyph=n,this._fallbackTabGlyph=o(n,{x:0,y:0,xadvance:e,id:l,xoffset:0,yoffset:0,width:0,height:0})}},d.prototype.getGlyph=function(t,n){return m(t,n)||(n===l?this._fallbackTabGlyph:n===p?this._fallbackSpaceGlyph:null)},d.prototype.computeMetrics=function(t,n,e,r){var i,a=this._opt.letterSpacing||0,o=this._opt.font,s=0,h=0,u=0;if(!o.chars||0===o.chars.length)return{start:n,end:n,width:0};e=Math.min(t.length,e);for(var c=n;c<e;c++){var f,l=t.charCodeAt(c);if(f=this.getGlyph(o,l)){var p=(s+=i?y(o,i.id,f.id):0)+f.xadvance+a,d=s+f.width;if(d>=r||p>=r)break;s=p,h=d,i=f}u++}return i&&(h+=i.xoffset),{start:n,end:n+u,width:h}},["width","height","descender","ascender","xHeight","baseline","capHeight","lineHeight"].forEach(function(t){Object.defineProperty(d.prototype,t,{get:g(t),configurable:!0})});var v=Object.prototype.toString;function x(t){return!!t.constructor&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)}var w=[0,2,3],_=[2,1,3];function A(t){const n=t.length/2,e={min:[t[0],t[1]],max:[t[0],t[1]]};for(let r=0;r<n;r++){const n=t[2*r+0],i=t[2*r+1];e.min[0]=Math.min(n,e.min[0]),e.min[1]=Math.min(i,e.min[1]),e.max[0]=Math.max(n,e.max[0]),e.max[1]=Math.max(i,e.max[1])}return e}class S extends t{constructor(t){super(),this.update(t)}update(t){if(!t.font)throw new TypeError("must specify a { font } in options");this.layout=function(t){return new d(t)}(t);const e=!1!==t.flipY,{font:r}=t,i=r.common.scaleW,a=r.common.scaleH,o=this.layout.glyphs.filter(t=>{const n=t.data;return n.width*n.height>0});this.visibleGlyphs=o;const s=function(t){const n=new Float32Array(4*t.length*2);let e=0;return t.forEach(t=>{const r=t.data,i=t.position[0]+r.xoffset,a=t.position[1]+r.yoffset,o=r.width,s=r.height;n[e++]=i,n[e++]=a,n[e++]=i,n[e++]=a+s,n[e++]=i+o,n[e++]=a+s,n[e++]=i+o,n[e++]=a}),n}(o),h=function(t,n,e,r){const i=new Float32Array(4*t.length*2);let a=0;return t.forEach(t=>{const o=t.data,s=o.y+o.height,h=o.x/n;let u=o.y/e;const c=(o.x+o.width)/n;let f=s/e;r&&(u=(e-o.y)/e,f=(e-s)/e),i[a++]=h,i[a++]=u,i[a++]=h,i[a++]=f,i[a++]=c,i[a++]=f,i[a++]=c,i[a++]=u}),i}(o,i,a,e),u=function(t,n){var e,r;t&&((r=t).BYTES_PER_ELEMENT&&"[object ArrayBuffer]"===v.call(r.buffer)||Array.isArray(r)||null!=(e=t)&&(x(e)||function(t){return"function"==typeof t.readFloatLE&&"function"==typeof t.slice&&x(t.slice(0,0))}(e)||e._isBuffer))||(n=t||{},t=null);for(var i=(n="number"==typeof n?{count:n}:n||{}).start||0,a=!1!==n.clockwise?w:_,o=a[0],s=a[1],h=a[2],u=6*("number"==typeof n.count?n.count:1),c=t||new(function(t){switch(t){case"int8":return Int8Array;case"int16":return Int16Array;case"int32":return Int32Array;case"uint8":return Uint8Array;case"uint16":return Uint16Array;case"uint32":return Uint32Array;case"float32":return Float32Array;case"float64":return Float64Array;case"array":return Array;case"uint8_clamped":return Uint8ClampedArray}}("string"==typeof n.type?n.type:"uint16"))(u),f=0,l=0;f<u;f+=6,l+=4){var p=f+i;c[p+0]=l+0,c[p+1]=l+1,c[p+2]=l+2,c[p+3]=l+o,c[p+4]=l+s,c[p+5]=l+h}return c}({clockwise:!0,type:"uint16",count:o.length});this.setIndex(u),this.setAttribute("position",new n(s,2)),this.setAttribute("uv",new n(h,2)),"page"in this.attributes&&this.deleteAttribute("page")}computeBoundingSphere(){this.boundingSphere||(this.boundingSphere=new e);const t=this.attributes.position.array,{itemSize:n}=this.attributes.position;if(!t||!n||t.length<2)return this.boundingSphere.radius=0,void this.boundingSphere.center.set(0,0,0);!function(t,n){const e=A(t),r=e.min[0],i=e.min[1],a=e.max[0]-r,o=e.max[1]-i,s=Math.sqrt(a*a+o*o);n.center.set(r+a/2,i+o/2,0),n.radius=s/2}(t,this.boundingSphere)}computeBoundingBox(){this.boundingBox||(this.boundingBox=new r);const t=this.attributes.position.array,{itemSize:n}=this.attributes.position;!t||!n||t.length<2?this.boundingBox.makeEmpty():function(t,n){const e=A(t);n.min.set(e.min[0],e.min[1],0),n.max.set(e.max[0],e.max[1],0)}(t,this.boundingBox)}}export{S as TextGeometry};
//# sourceMappingURL=three-bmfont-text.modern.js.map
