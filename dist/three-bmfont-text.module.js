import{BufferAttribute as t,Sphere as r,Box3 as n,BufferGeometry as e}from"three";function i(){return(i=Object.assign||function(t){for(var r=1;r<arguments.length;r++){var n=arguments[r];for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])}return t}).apply(this,arguments)}function a(t,r){return(a=Object.setPrototypeOf||function(t,r){return t.__proto__=r,t})(t,r)}var o,h=(function(t){var r=/\n/,n="\n",e=/\s/;function i(t,r,n,e){var i=t.indexOf(r,n);return-1===i||i>e?e:i}function a(t){return e.test(t)}function o(t,r,n,e){return{start:r,end:r+Math.min(e,n-r)}}t.exports=function(r,n){return t.exports.lines(r,n).map(function(t){return r.substring(t.start,t.end)}).join("\n")},t.exports.lines=function(t,e){if(0===(e=e||{}).width&&"nowrap"!==e.mode)return[];t=t||"";var h="number"==typeof e.width?e.width:Number.MAX_VALUE,s=Math.max(0,e.start||0),u="number"==typeof e.end?e.end:t.length,c=e.mode,f=e.measure||o;return"pre"===c?function(t,n,e,i,a){for(var o=[],h=e,s=e;s<i&&s<n.length;s++){var u=n.charAt(s),c=r.test(u);if(c||s===i-1){var f=t(n,h,c?s:s+1,a);o.push(f),h=s+1}}return o}(f,t,s,u,h):function(t,r,e,o,h,s){var u=[],c=h;for("nowrap"===s&&(c=Number.MAX_VALUE);e<o&&e<r.length;){for(var f=i(r,n,e,o);e<f&&a(r.charAt(e));)e++;var p=t(r,e,f,c),l=e+(p.end-p.start),d=l+n.length;if(l<f){for(;l>e&&!a(r.charAt(l));)l--;if(l===e)d>e+n.length&&d--,l=d;else for(d=l;l>e&&a(r.charAt(l-n.length));)l--}if(l>=e){var g=t(r,e,l,c);u.push(g)}e=d}return u}(f,t,s,u,h,c)}}(o={exports:{}}),o.exports),s=function(){for(var t={},r=0;r<arguments.length;r++){var n=arguments[r];for(var e in n)u.call(n,e)&&(t[e]=n[e])}return t},u=Object.prototype.hasOwnProperty,c=function(t,r){return"number"==typeof t?t:"number"==typeof r?r:0},f=["x","e","a","o","n","s","r","c","u","m","v","w","z"],p=["m","w"],l=["H","I","N","E","F","K","L","T","U","V","W","X","Y","Z"],d="\t".charCodeAt(0),g=" ".charCodeAt(0),y=function(t){return new v(t)};function v(t){this.glyphs=[],this._measure=this.computeMetrics.bind(this),this.update(t)}function m(t){return new Function(["return function "+t+"() {","  return this._"+t,"}"].join("\n"))()}function b(t,r){if(!t.chars||0===t.chars.length)return null;var n=_(t.chars,r);return n>=0?t.chars[n]:null}function x(t,r,n){if(!t.kernings||0===t.kernings.length)return 0;for(var e=t.kernings,i=0;i<e.length;i++){var a=e[i];if(a.first===r&&a.second===n)return a.amount}return 0}function _(t,r,n){for(var e=n=n||0;e<t.length;e++)if(t[e].id===r)return e;return-1}v.prototype.update=function(t){if(t=s({measure:this._measure},t),this._opt=t,this._opt.tabSize=c(this._opt.tabSize,4),!t.font)throw new Error("must provide a valid bitmap font");var r=this.glyphs,n=t.text||"",e=t.font;this._setupSpaceGlyphs(e);var i=h.lines(n,t),a=t.width||0;r.length=0;var o=i.reduce(function(t,r){return Math.max(t,r.width,a)},0),u=0,p=0,d=c(t.lineHeight,e.common.lineHeight),g=e.common.base,y=d-g,v=t.letterSpacing||0,m=d*i.length-y,b=function(t){return"center"===t?1:"right"===t?2:0}(this._opt.align);p-=m,this._width=o,this._height=m,this._descender=d-g,this._baseline=g,this._xHeight=function(t){for(var r=0;r<f.length;r++){var n=f[r].charCodeAt(0),e=_(t.chars,n);if(e>=0)return t.chars[e].height}return 0}(e),this._capHeight=function(t){for(var r=0;r<l.length;r++){var n=l[r].charCodeAt(0),e=_(t.chars,n);if(e>=0)return t.chars[e].height}return 0}(e),this._lineHeight=d,this._ascender=d-y-this._xHeight;var w=this;i.forEach(function(t,i){for(var a,h=t.end,s=t.width,c=t.start;c<h;c++){var f=n.charCodeAt(c),l=w.getGlyph(e,f);if(l){a&&(u+=x(e,a.id,l.id));var g=u;1===b?g+=(o-s)/2:2===b&&(g+=o-s),r.push({position:[g,p],data:l,index:c,line:i}),u+=l.xadvance+v,a=l}}p+=d,u=0}),this._linesTotal=i.length},v.prototype._setupSpaceGlyphs=function(t){if(this._fallbackSpaceGlyph=null,this._fallbackTabGlyph=null,t.chars&&0!==t.chars.length){var r=b(t,g)||function(t){for(var r=0;r<p.length;r++){var n=p[r].charCodeAt(0),e=_(t.chars,n);if(e>=0)return t.chars[e]}return 0}(t)||t.chars[0],n=this._opt.tabSize*r.xadvance;this._fallbackSpaceGlyph=r,this._fallbackTabGlyph=s(r,{x:0,y:0,xadvance:n,id:d,xoffset:0,yoffset:0,width:0,height:0})}},v.prototype.getGlyph=function(t,r){return b(t,r)||(r===d?this._fallbackTabGlyph:r===g?this._fallbackSpaceGlyph:null)},v.prototype.computeMetrics=function(t,r,n,e){var i,a=this._opt.letterSpacing||0,o=this._opt.font,h=0,s=0,u=0;if(!o.chars||0===o.chars.length)return{start:r,end:r,width:0};n=Math.min(t.length,n);for(var c=r;c<n;c++){var f,p=t.charCodeAt(c);if(f=this.getGlyph(o,p)){var l=(h+=i?x(o,i.id,f.id):0)+f.xadvance+a,d=h+f.width;if(d>=e||l>=e)break;h=l,s=d,i=f}u++}return i&&(s+=i.xoffset),{start:r,end:r+u,width:s}},["width","height","descender","ascender","xHeight","baseline","capHeight","lineHeight"].forEach(function(t){Object.defineProperty(v.prototype,t,{get:m(t),configurable:!0})});var w=Object.prototype.toString;function A(t){return!!t.constructor&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)}var S=[0,2,3],E=[2,1,3];function M(t){for(var r=t.length/2,n={min:[t[0],t[1]],max:[t[0],t[1]]},e=0;e<r;e++){var i=t[2*e+0],a=t[2*e+1];n.min[0]=Math.min(i,n.min[0]),n.min[1]=Math.min(a,n.min[1]),n.max[0]=Math.max(i,n.max[0]),n.max[1]=Math.max(a,n.max[1])}return n}var k=function(e){var o,h;function s(t){var r;return(r=e.call(this)||this).options=i({},t),r.update(t),r}h=e,(o=s).prototype=Object.create(h.prototype),o.prototype.constructor=o,a(o,h);var u=s.prototype;return u.update=function(r){if(!(r=i({},this.options,r)).font)throw new TypeError("must specify a { font } in options");this.layout=y(r);var n=!1!==r.flipY,e=r.font,a=e.common.scaleW,o=e.common.scaleH,h=this.layout.glyphs.filter(function(t){var r=t.data;return r.width*r.height>0});this.visibleGlyphs=h;var s=function(t){var r=new Float32Array(4*t.length*2),n=0;return t.forEach(function(t){var e=t.data,i=t.position[0]+e.xoffset,a=t.position[1]+e.yoffset,o=e.width,h=e.height;r[n++]=i,r[n++]=a,r[n++]=i,r[n++]=a+h,r[n++]=i+o,r[n++]=a+h,r[n++]=i+o,r[n++]=a}),r}(h),u=function(t,r,n,e){var i=new Float32Array(4*t.length*2),a=0;return t.forEach(function(t){var o=t.data,h=o.y+o.height,s=o.x/r,u=o.y/n,c=(o.x+o.width)/r,f=h/n;e&&(u=(n-o.y)/n,f=(n-h)/n),i[a++]=s,i[a++]=u,i[a++]=s,i[a++]=f,i[a++]=c,i[a++]=f,i[a++]=c,i[a++]=u}),i}(h,a,o,n),c=function(t,r){var n,e;t&&((e=t).BYTES_PER_ELEMENT&&"[object ArrayBuffer]"===w.call(e.buffer)||Array.isArray(e)||null!=(n=t)&&(A(n)||function(t){return"function"==typeof t.readFloatLE&&"function"==typeof t.slice&&A(t.slice(0,0))}(n)||n._isBuffer))||(r=t||{},t=null);for(var i=(r="number"==typeof r?{count:r}:r||{}).start||0,a=!1!==r.clockwise?S:E,o=a[0],h=a[1],s=a[2],u=6*("number"==typeof r.count?r.count:1),c=t||new(function(t){switch(t){case"int8":return Int8Array;case"int16":return Int16Array;case"int32":return Int32Array;case"uint8":return Uint8Array;case"uint16":return Uint16Array;case"uint32":return Uint32Array;case"float32":return Float32Array;case"float64":return Float64Array;case"array":return Array;case"uint8_clamped":return Uint8ClampedArray}}("string"==typeof r.type?r.type:"uint16"))(u),f=0,p=0;f<u;f+=6,p+=4){var l=f+i;c[l+0]=p+0,c[l+1]=p+1,c[l+2]=p+2,c[l+3]=p+o,c[l+4]=p+h,c[l+5]=p+s}return c}({clockwise:!0,type:"uint16",count:h.length});this.setIndex(new t(c,1)),this.setAttribute("position",new t(s,2)),this.setAttribute("uv",new t(u,2)),"page"in this.attributes&&this.deleteAttribute("page")},u.computeBoundingSphere=function(){this.boundingSphere||(this.boundingSphere=new r);var t=this.attributes.position.array;if(!t||!this.attributes.position.itemSize||t.length<2)return this.boundingSphere.radius=0,void this.boundingSphere.center.set(0,0,0);!function(t,r){var n=M(t),e=n.min[0],i=n.min[1],a=n.max[0]-e,o=n.max[1]-i,h=Math.sqrt(a*a+o*o);r.center.set(e+a/2,i+o/2,0),r.radius=h/2}(t,this.boundingSphere)},u.computeBoundingBox=function(){this.boundingBox||(this.boundingBox=new n);var t=this.attributes.position.array;!t||!this.attributes.position.itemSize||t.length<2?this.boundingBox.makeEmpty():function(t,r){var n=M(t);r.min.set(n.min[0],n.min[1],0),r.max.set(n.max[0],n.max[1],0)}(t,this.boundingBox)},s}(e);export{k as TextGeometry,y as __moduleExports};
//# sourceMappingURL=three-bmfont-text.module.js.map
