!function(t,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports,require("three")):"function"==typeof define&&define.amd?define(["exports","three"],r):r((t=t||self).threeBmfontText={},t.three)}(this,function(t,r){var e=function(t,r){return function(t){var r=/\n/,e=/\s/;function n(t,r,e,n){var i=t.indexOf(r,e);return-1===i||i>n?n:i}function i(t){return e.test(t)}function a(t,r,e,n){return{start:r,end:r+Math.min(n,e-r)}}t.exports=function(r,e){return t.exports.lines(r,e).map(function(t){return r.substring(t.start,t.end)}).join("\n")},t.exports.lines=function(t,e){if(0===(e=e||{}).width&&"nowrap"!==e.mode)return[];t=t||"";var o="number"==typeof e.width?e.width:Number.MAX_VALUE,u=Math.max(0,e.start||0),s="number"==typeof e.end?e.end:t.length,h=e.mode,c=e.measure||a;return"pre"===h?function(t,e,n,i,a){for(var o=[],u=n,s=n;s<i&&s<e.length;s++){var h=e.charAt(s),c=r.test(h);if(c||s===i-1){var f=t(e,u,c?s:s+1,a);o.push(f),u=s+1}}return o}(c,t,u,s,o):function(t,r,e,a,o,u){var s=[],h=o;for("nowrap"===u&&(h=Number.MAX_VALUE);e<a&&e<r.length;){for(var c=n(r,"\n",e,a);e<c&&i(r.charAt(e));)e++;var f=t(r,e,c,h),l=e+(f.end-f.start),p=l+"\n".length;if(l<c){for(;l>e&&!i(r.charAt(l));)l--;if(l===e)p>e+"\n".length&&p--,l=p;else for(p=l;l>e&&i(r.charAt(l-"\n".length));)l--}if(l>=e){var y=t(r,e,l,h);s.push(y)}e=p}return s}(c,t,u,s,o,h)}}(r={exports:{}}),r.exports}(),n=function(){for(var t={},r=0;r<arguments.length;r++){var e=arguments[r];for(var n in e)i.call(e,n)&&(t[n]=e[n])}return t},i=Object.prototype.hasOwnProperty,a=function(t,r){return"number"==typeof t?t:"number"==typeof r?r:0},o=["x","e","a","o","n","s","r","c","u","m","v","w","z"],u=["m","w"],s=["H","I","N","E","F","K","L","T","U","V","W","X","Y","Z"],h="\t".charCodeAt(0),c=" ".charCodeAt(0);function f(t){this.glyphs=[],this._measure=this.computeMetrics.bind(this),this.update(t)}function l(t){return new Function(["return function "+t+"() {","  return this._"+t,"}"].join("\n"))()}function p(t,r){if(!t.chars||0===t.chars.length)return null;var e=d(t.chars,r);return e>=0?t.chars[e]:null}function y(t,r,e){if(!t.kernings||0===t.kernings.length)return 0;for(var n=t.kernings,i=0;i<n.length;i++){var a=n[i];if(a.first===r&&a.second===e)return a.amount}return 0}function d(t,r,e){for(var n=e=e||0;n<t.length;n++)if(t[n].id===r)return n;return-1}f.prototype.update=function(t){if(t=n({measure:this._measure},t),this._opt=t,this._opt.tabSize=a(this._opt.tabSize,4),!t.font)throw new Error("must provide a valid bitmap font");var r=this.glyphs,i=t.text||"",u=t.font;this._setupSpaceGlyphs(u);var h=e.lines(i,t),c=t.width||0;r.length=0;var f=h.reduce(function(t,r){return Math.max(t,r.width,c)},0),l=0,p=0,g=a(t.lineHeight,u.common.lineHeight),m=u.common.base,v=g-m,b=t.letterSpacing||0,x=g*h.length-v,A=function(t){return"center"===t?1:"right"===t?2:0}(this._opt.align);p-=x,this._width=f,this._height=x,this._descender=g-m,this._baseline=m,this._xHeight=function(t){for(var r=0;r<o.length;r++){var e=o[r].charCodeAt(0),n=d(t.chars,e);if(n>=0)return t.chars[n].height}return 0}(u),this._capHeight=function(t){for(var r=0;r<s.length;r++){var e=s[r].charCodeAt(0),n=d(t.chars,e);if(n>=0)return t.chars[n].height}return 0}(u),this._lineHeight=g,this._ascender=g-v-this._xHeight;var w=this;h.forEach(function(t,e){for(var n,a=t.end,o=t.width,s=t.start;s<a;s++){var h=i.charCodeAt(s),c=w.getGlyph(u,h);if(c){n&&(l+=y(u,n.id,c.id));var d=l;1===A?d+=(f-o)/2:2===A&&(d+=f-o),r.push({position:[d,p],data:c,index:s,line:e}),l+=c.xadvance+b,n=c}}p+=g,l=0}),this._linesTotal=h.length},f.prototype._setupSpaceGlyphs=function(t){if(this._fallbackSpaceGlyph=null,this._fallbackTabGlyph=null,t.chars&&0!==t.chars.length){var r=p(t,c)||function(t){for(var r=0;r<u.length;r++){var e=u[r].charCodeAt(0),n=d(t.chars,e);if(n>=0)return t.chars[n]}return 0}(t)||t.chars[0],e=this._opt.tabSize*r.xadvance;this._fallbackSpaceGlyph=r,this._fallbackTabGlyph=n(r,{x:0,y:0,xadvance:e,id:h,xoffset:0,yoffset:0,width:0,height:0})}},f.prototype.getGlyph=function(t,r){return p(t,r)||(r===h?this._fallbackTabGlyph:r===c?this._fallbackSpaceGlyph:null)},f.prototype.computeMetrics=function(t,r,e,n){var i,a=this._opt.letterSpacing||0,o=this._opt.font,u=0,s=0,h=0;if(!o.chars||0===o.chars.length)return{start:r,end:r,width:0};e=Math.min(t.length,e);for(var c=r;c<e;c++){var f,l=t.charCodeAt(c);if(f=this.getGlyph(o,l)){var p=(u+=i?y(o,i.id,f.id):0)+f.xadvance+a,d=u+f.width;if(d>=n||p>=n)break;u=p,s=d,i=f}h++}return i&&(s+=i.xoffset),{start:r,end:r+h,width:s}},["width","height","descender","ascender","xHeight","baseline","capHeight","lineHeight"].forEach(function(t){Object.defineProperty(f.prototype,t,{get:l(t),configurable:!0})});var g=Object.prototype.toString;function m(t){return!!t.constructor&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)}var v=[0,2,3],b=[2,1,3],x=function(t){switch(t){case"int8":return Int8Array;case"int16":return Int16Array;case"int32":return Int32Array;case"uint8":return Uint8Array;case"uint16":return Uint16Array;case"uint32":return Uint32Array;case"float32":return Float32Array;case"float64":return Float64Array;case"array":return Array;case"uint8_clamped":return Uint8ClampedArray}},A=function(t,r,e){if(!t)throw new TypeError("must specify data as first parameter");if(e=0|+(e||0),Array.isArray(t)&&t[0]&&"number"==typeof t[0][0]){var n,i,a,o,u=t[0].length,s=t.length*u;r&&"string"!=typeof r||(r=new(x(r||"float32"))(s+e));var h=r.length-e;if(s!==h)throw new Error("source length "+s+" ("+u+"x"+t.length+") does not match destination length "+h);for(n=0,a=e;n<t.length;n++)for(i=0;i<u;i++)r[a++]=null===t[n][i]?NaN:t[n][i]}else if(r&&"string"!=typeof r)r.set(t,e);else{var c=x(r||"float32");if(Array.isArray(t)||"array"===r)for(n=0,a=e,o=(r=new c(t.length+e)).length;a<o;a++,n++)r[a]=null===t[n]?NaN:t[n];else 0===e?r=new c(t):(r=new c(t.length+e)).set(t,e)}return r};function w(t,r,e,n,i){if("number"!=typeof n&&(n=3),"string"!=typeof i&&(i="float32"),Array.isArray(e)&&Array.isArray(e[0])&&e[0].length!==n)throw new Error("Nested vertex array has unexpected size; expected "+n+" but found "+e[0].length);var a=_(e,n,i);t.setAttribute(r,a)}function _(t,e,n){t=A(t=t||[],n);var i=new r.BufferAttribute(t,e);return i.itemSize=e,i.needsUpdate=!0,i}function S(t){for(var r=t.length/2,e={min:[t[0],t[1]],max:[t[0],t[1]]},n=0;n<r;n++){var i=t[2*n+0],a=t[2*n+1];e.min[0]=Math.min(i,e.min[0]),e.min[1]=Math.min(a,e.min[1]),e.max[0]=Math.max(i,e.max[0]),e.max[1]=Math.max(a,e.max[1])}return e}t.TextGeometry=function(t){var e,n;function i(r){var e;return(e=t.call(this)||this).update(r),e}n=t,(e=i).prototype=Object.create(n.prototype),e.prototype.constructor=e,e.__proto__=n;var a=i.prototype;return a.update=function(t){if(!t.font)throw new TypeError("must specify a { font } in options");this.layout=function(t){return new f(t)}(t);var r=!1!==t.flipY,e=t.font,n=e.common.scaleW,i=e.common.scaleH,a=this.layout.glyphs.filter(function(t){var r=t.data;return r.width*r.height>0});this.visibleGlyphs=a;var o=function(t){var r=new Float32Array(4*t.length*2),e=0;return t.forEach(function(t){var n=t.data,i=t.position[0]+n.xoffset,a=t.position[1]+n.yoffset,o=n.width,u=n.height;r[e++]=i,r[e++]=a,r[e++]=i,r[e++]=a+u,r[e++]=i+o,r[e++]=a+u,r[e++]=i+o,r[e++]=a}),r}(a),u=function(t,r,e,n){var i=new Float32Array(4*t.length*2),a=0;return t.forEach(function(t){var o=t.data,u=o.y+o.height,s=o.x/r,h=o.y/e,c=(o.x+o.width)/r,f=u/e;n&&(h=(e-o.y)/e,f=(e-u)/e),i[a++]=s,i[a++]=h,i[a++]=s,i[a++]=f,i[a++]=c,i[a++]=f,i[a++]=c,i[a++]=h}),i}(a,n,i,r);!function(t,r,e,n){"number"!=typeof e&&(e=1),"string"!=typeof n&&(n="uint16");var i=_(r,e,n);i&&(t.index||"function"==typeof t.setIndex?t.index=i:t.addAttribute("index",i))}(this,function(t,r){var e,n;t&&((n=t).BYTES_PER_ELEMENT&&"[object ArrayBuffer]"===g.call(n.buffer)||Array.isArray(n)||null!=(e=t)&&(m(e)||function(t){return"function"==typeof t.readFloatLE&&"function"==typeof t.slice&&m(t.slice(0,0))}(e)||e._isBuffer))||(r=t||{},t=null);for(var i=(r="number"==typeof r?{count:r}:r||{}).start||0,a=!1!==r.clockwise?v:b,o=a[0],u=a[1],s=a[2],h=6*("number"==typeof r.count?r.count:1),c=t||new(function(t){switch(t){case"int8":return Int8Array;case"int16":return Int16Array;case"int32":return Int32Array;case"uint8":return Uint8Array;case"uint16":return Uint16Array;case"uint32":return Uint32Array;case"float32":return Float32Array;case"float64":return Float64Array;case"array":return Array;case"uint8_clamped":return Uint8ClampedArray}}("string"==typeof r.type?r.type:"uint16"))(h),f=0,l=0;f<h;f+=6,l+=4){var p=f+i;c[p+0]=l+0,c[p+1]=l+1,c[p+2]=l+2,c[p+3]=l+o,c[p+4]=l+u,c[p+5]=l+s}return c}({clockwise:!0,type:"uint16",count:a.length}),1,"uint16"),w(this,"position",o,2),w(this,"uv",u,2),"page"in this.attributes&&this.removeAttribute("page")},a.computeBoundingSphere=function(){this.boundingSphere||(this.boundingSphere=new r.Sphere);var t=this.attributes.position.array;if(!t||!this.attributes.position.itemSize||t.length<2)return this.boundingSphere.radius=0,void this.boundingSphere.center.set(0,0,0);!function(t,r){var e=S(t),n=e.min[0],i=e.min[1],a=e.max[0]-n,o=e.max[1]-i,u=Math.sqrt(a*a+o*o);r.center.set(n+a/2,i+o/2,0),r.radius=u/2}(t,this.boundingSphere)},a.computeBoundingBox=function(){this.boundingBox||(this.boundingBox=new r.Box3);var t=this.attributes.position.array;!t||!this.attributes.position.itemSize||t.length<2?this.boundingBox.makeEmpty():function(t,r){var e=S(t);r.min.set(e.min[0],e.min[1],0),r.max.set(e.max[0],e.max[1],0)}(t,this.boundingBox)},i}(r.BufferGeometry)});
//# sourceMappingURL=three-bmfont-text.umd.js.map
