!function(t,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports,require("three")):"function"==typeof define&&define.amd?define(["exports","three"],r):r((t||self).threeBmfontText={},t.three)}(this,function(t,r){function e(){return(e=Object.assign||function(t){for(var r=1;r<arguments.length;r++){var e=arguments[r];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])}return t}).apply(this,arguments)}function n(t,r){return(n=Object.setPrototypeOf||function(t,r){return t.__proto__=r,t})(t,r)}var i=function(t){var r={exports:{}};return function(t){var r=/\n/,e="\n",n=/\s/;function i(t,r,e,n){var i=t.indexOf(r,e);return-1===i||i>n?n:i}function o(t){return n.test(t)}function a(t,r,e,n){return{start:r,end:r+Math.min(n,e-r)}}t.exports=function(r,e){return t.exports.lines(r,e).map(function(t){return r.substring(t.start,t.end)}).join("\n")},t.exports.lines=function(t,n){if(0===(n=n||{}).width&&"nowrap"!==n.mode)return[];t=t||"";var u="number"==typeof n.width?n.width:Number.MAX_VALUE,h=Math.max(0,n.start||0),s="number"==typeof n.end?n.end:t.length,c=n.mode,f=n.measure||a;return"pre"===c?function(t,e,n,i,o){for(var a=[],u=n,h=n;h<i&&h<e.length;h++){var s=e.charAt(h),c=r.test(s);if(c||h===i-1){var f=t(e,u,c?h:h+1,o);a.push(f),u=h+1}}return a}(f,t,h,s,u):function(t,r,n,a,u,h){var s=[],c=u;for("nowrap"===h&&(c=Number.MAX_VALUE);n<a&&n<r.length;){for(var f=i(r,e,n,a);n<f&&o(r.charAt(n));)n++;var p=t(r,n,f,c),l=n+(p.end-p.start),d=l+e.length;if(l<f){for(;l>n&&!o(r.charAt(l));)l--;if(l===n)d>n+e.length&&d--,l=d;else for(d=l;l>n&&o(r.charAt(l-e.length));)l--}if(l>=n){var y=t(r,n,l,c);s.push(y)}n=d}return s}(f,t,h,s,u,c)}}(r),r.exports}(),o=function(){for(var t={},r=0;r<arguments.length;r++){var e=arguments[r];for(var n in e)a.call(e,n)&&(t[n]=e[n])}return t},a=Object.prototype.hasOwnProperty,u=function(t,r){return"number"==typeof t?t:"number"==typeof r?r:0},h=["x","e","a","o","n","s","r","c","u","m","v","w","z"],s=["m","w"],c=["H","I","N","E","F","K","L","T","U","V","W","X","Y","Z"],f="\t".charCodeAt(0),p=" ".charCodeAt(0),l=function(t){return new d(t)};function d(t){this.glyphs=[],this._measure=this.computeMetrics.bind(this),this.update(t)}function y(t){return new Function(["return function "+t+"() {","  return this._"+t,"}"].join("\n"))()}function g(t,r){if(!t.chars||0===t.chars.length)return null;var e=v(t.chars,r);return e>=0?t.chars[e]:null}function m(t,r,e){if(!t.kernings||0===t.kernings.length)return 0;for(var n=t.kernings,i=0;i<n.length;i++){var o=n[i];if(o.first===r&&o.second===e)return o.amount}return 0}function v(t,r,e){for(var n=e=e||0;n<t.length;n++)if(t[n].id===r)return n;return-1}d.prototype.update=function(t){if(t=o({measure:this._measure},t),this._opt=t,this._opt.tabSize=u(this._opt.tabSize,4),!t.font)throw new Error("must provide a valid bitmap font");var r=this.glyphs,e=t.text||"",n=t.font;this._setupSpaceGlyphs(n);var a=i.lines(e,t),s=t.width||0;r.length=0;var f=a.reduce(function(t,r){return Math.max(t,r.width,s)},0),p=0,l=0,d=u(t.lineHeight,n.common.lineHeight),y=n.common.base,g=d-y,b=t.letterSpacing||0,x=d*a.length-g,_=function(t){return"center"===t?1:"right"===t?2:0}(this._opt.align);l-=x,this._width=f,this._height=x,this._descender=d-y,this._baseline=y,this._xHeight=function(t){for(var r=0;r<h.length;r++){var e=h[r].charCodeAt(0),n=v(t.chars,e);if(n>=0)return t.chars[n].height}return 0}(n),this._capHeight=function(t){for(var r=0;r<c.length;r++){var e=c[r].charCodeAt(0),n=v(t.chars,e);if(n>=0)return t.chars[n].height}return 0}(n),this._lineHeight=d,this._ascender=d-g-this._xHeight;var w=this;a.forEach(function(t,i){for(var o,a=t.end,u=t.width,h=t.start;h<a;h++){var s=e.charCodeAt(h),c=w.getGlyph(n,s);if(c){o&&(p+=m(n,o.id,c.id));var y=p;1===_?y+=(f-u)/2:2===_&&(y+=f-u),r.push({position:[y,l],data:c,index:h,line:i}),p+=c.xadvance+b,o=c}}l+=d,p=0}),this._linesTotal=a.length},d.prototype._setupSpaceGlyphs=function(t){if(this._fallbackSpaceGlyph=null,this._fallbackTabGlyph=null,t.chars&&0!==t.chars.length){var r=g(t,p)||function(t){for(var r=0;r<s.length;r++){var e=s[r].charCodeAt(0),n=v(t.chars,e);if(n>=0)return t.chars[n]}return 0}(t)||t.chars[0],e=this._opt.tabSize*r.xadvance;this._fallbackSpaceGlyph=r,this._fallbackTabGlyph=o(r,{x:0,y:0,xadvance:e,id:f,xoffset:0,yoffset:0,width:0,height:0})}},d.prototype.getGlyph=function(t,r){return g(t,r)||(r===f?this._fallbackTabGlyph:r===p?this._fallbackSpaceGlyph:null)},d.prototype.computeMetrics=function(t,r,e,n){var i,o=this._opt.letterSpacing||0,a=this._opt.font,u=0,h=0,s=0;if(!a.chars||0===a.chars.length)return{start:r,end:r,width:0};e=Math.min(t.length,e);for(var c=r;c<e;c++){var f,p=t.charCodeAt(c);if(f=this.getGlyph(a,p)){var l=(u+=i?m(a,i.id,f.id):0)+f.xadvance+o,d=u+f.width;if(d>=n||l>=n)break;u=l,h=d,i=f}s++}return i&&(h+=i.xoffset),{start:r,end:r+s,width:h}},["width","height","descender","ascender","xHeight","baseline","capHeight","lineHeight"].forEach(function(t){Object.defineProperty(d.prototype,t,{get:y(t),configurable:!0})});var b=Object.prototype.toString;function x(t){return!!t.constructor&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)}var _=[0,2,3],w=[2,1,3];function A(t){for(var r=t.length/2,e={min:[t[0],t[1]],max:[t[0],t[1]]},n=0;n<r;n++){var i=t[2*n+0],o=t[2*n+1];e.min[0]=Math.min(i,e.min[0]),e.min[1]=Math.min(o,e.min[1]),e.max[0]=Math.max(i,e.max[0]),e.max[1]=Math.max(o,e.max[1])}return e}t.TextGeometry=function(t){var i,o;function a(r){var n;return(n=t.call(this)||this).options=e({},r),n.update(r),n}o=t,(i=a).prototype=Object.create(o.prototype),i.prototype.constructor=i,n(i,o);var u=a.prototype;return u.update=function(t){if(!(t=e({},this.options,t)).font)throw new TypeError("must specify a { font } in options");this.layout=l(t);var n=!1!==t.flipY,i=t.font,o=i.common.scaleW,a=i.common.scaleH,u=this.layout.glyphs.filter(function(t){var r=t.data;return r.width*r.height>0});this.visibleGlyphs=u;var h=function(t){var r=new Float32Array(4*t.length*2),e=0;return t.forEach(function(t){var n=t.data,i=t.position[0]+n.xoffset,o=t.position[1]+n.yoffset,a=n.width,u=n.height;r[e++]=i,r[e++]=o,r[e++]=i,r[e++]=o+u,r[e++]=i+a,r[e++]=o+u,r[e++]=i+a,r[e++]=o}),r}(u),s=function(t,r,e,n){var i=new Float32Array(4*t.length*2),o=0;return t.forEach(function(t){var a=t.data,u=a.y+a.height,h=a.x/r,s=a.y/e,c=(a.x+a.width)/r,f=u/e;n&&(s=(e-a.y)/e,f=(e-u)/e),i[o++]=h,i[o++]=s,i[o++]=h,i[o++]=f,i[o++]=c,i[o++]=f,i[o++]=c,i[o++]=s}),i}(u,o,a,n),c=function(t,r){var e,n;t&&((n=t).BYTES_PER_ELEMENT&&"[object ArrayBuffer]"===b.call(n.buffer)||Array.isArray(n)||null!=(e=t)&&(x(e)||function(t){return"function"==typeof t.readFloatLE&&"function"==typeof t.slice&&x(t.slice(0,0))}(e)||e._isBuffer))||(r=t||{},t=null);for(var i=(r="number"==typeof r?{count:r}:r||{}).start||0,o=!1!==r.clockwise?_:w,a=o[0],u=o[1],h=o[2],s=6*("number"==typeof r.count?r.count:1),c=t||new(function(t){switch(t){case"int8":return Int8Array;case"int16":return Int16Array;case"int32":return Int32Array;case"uint8":return Uint8Array;case"uint16":return Uint16Array;case"uint32":return Uint32Array;case"float32":return Float32Array;case"float64":return Float64Array;case"array":return Array;case"uint8_clamped":return Uint8ClampedArray}}("string"==typeof r.type?r.type:"uint16"))(s),f=0,p=0;f<s;f+=6,p+=4){var l=f+i;c[l+0]=p+0,c[l+1]=p+1,c[l+2]=p+2,c[l+3]=p+a,c[l+4]=p+u,c[l+5]=p+h}return c}({clockwise:!0,type:"uint16",count:u.length});this.setIndex(new r.BufferAttribute(c,1)),this.setAttribute("position",new r.BufferAttribute(h,2)),this.setAttribute("uv",new r.BufferAttribute(s,2)),"page"in this.attributes&&this.deleteAttribute("page")},u.computeBoundingSphere=function(){this.boundingSphere||(this.boundingSphere=new r.Sphere);var t=this.attributes.position.array;if(!t||!this.attributes.position.itemSize||t.length<2)return this.boundingSphere.radius=0,void this.boundingSphere.center.set(0,0,0);!function(t,r){var e=A(t),n=e.min[0],i=e.min[1],o=e.max[0]-n,a=e.max[1]-i,u=Math.sqrt(o*o+a*a);r.center.set(n+o/2,i+a/2,0),r.radius=u/2}(t,this.boundingSphere)},u.computeBoundingBox=function(){this.boundingBox||(this.boundingBox=new r.Box3);var t=this.attributes.position.array;!t||!this.attributes.position.itemSize||t.length<2?this.boundingBox.makeEmpty():function(t,r){var e=A(t);r.min.set(e.min[0],e.min[1],0),r.max.set(e.max[0],e.max[1],0)}(t,this.boundingBox)},a}(r.BufferGeometry),t.__moduleExports=l});
//# sourceMappingURL=three-bmfont-text.umd.js.map
